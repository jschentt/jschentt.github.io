<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.json"};
  </script>

  <meta name="description" content="1 微信小程序基本知识与概念微信小程序开发，入门算是非常简单，只要看官方文档即可小程序简易教程。如何申请小程序账号，如何开发自己第一个小程序，如何发布，这一系列 hello world 操作官方文档都有手把手教学。小程序开发的每个步骤，提供的能力文档里都有，个人觉得，做小程序开发，有事没事都看下文档，因为小程序更新比较快速，同时一些细小的能力我们可能会漏掉，所以多看文档。 1.1 简单说下目录结构">
<meta property="og:type" content="article">
<meta property="og:title" content="微信小程序开发总结与心得">
<meta property="og:url" content="http://example.com/2022/12/16/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93%E4%B8%8E%E5%BF%83%E5%BE%97/index.html">
<meta property="og:site_name" content="Bruce Chen&#39;s Blog">
<meta property="og:description" content="1 微信小程序基本知识与概念微信小程序开发，入门算是非常简单，只要看官方文档即可小程序简易教程。如何申请小程序账号，如何开发自己第一个小程序，如何发布，这一系列 hello world 操作官方文档都有手把手教学。小程序开发的每个步骤，提供的能力文档里都有，个人觉得，做小程序开发，有事没事都看下文档，因为小程序更新比较快速，同时一些细小的能力我们可能会漏掉，所以多看文档。 1.1 简单说下目录结构">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/9224001-101ad1c2c34b78e2?imageMogr2/auto-orient/strip%7CimageView2/2/w/358/format/webp">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/9224001-34ea9f7b6d403430?imageMogr2/auto-orient/strip%7CimageView2/2/w/294/format/webp">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/9224001-f636fee7c8bb0521?imageMogr2/auto-orient/strip%7CimageView2/2/w/411/format/webp">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/9224001-453ef44118136478?imageMogr2/auto-orient/strip%7CimageView2/2/w/985/format/webp">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/9224001-9d9e1ef862ec01a2?imageMogr2/auto-orient/strip%7CimageView2/2/w/668/format/webp">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/9224001-7f06298163544864?imageMogr2/auto-orient/strip%7CimageView2/2/w/307/format/webp">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/9224001-5430f5ac8e795afe?imageMogr2/auto-orient/strip%7CimageView2/2/w/610/format/webp">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/9224001-9488d1d3f38ec3b2?imageMogr2/auto-orient/strip%7CimageView2/2/w/864/format/webp">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/9224001-59f56fb9a79610ae?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/9224001-0bbdba7dbe77acc9?imageMogr2/auto-orient/strip%7CimageView2/2/w/1118/format/webp">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/9224001-a5ed578b7aca2063?imageMogr2/auto-orient/strip%7CimageView2/2/w/855/format/webp">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/9224001-d8b9492d94d3f88d?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp">
<meta property="article:published_time" content="2022-12-16T05:58:49.000Z">
<meta property="article:modified_time" content="2022-12-16T06:01:51.285Z">
<meta property="article:author" content="Bruce Chen">
<meta property="article:tag" content="小程序">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://upload-images.jianshu.io/upload_images/9224001-101ad1c2c34b78e2?imageMogr2/auto-orient/strip%7CimageView2/2/w/358/format/webp">

<link rel="canonical" href="http://example.com/2022/12/16/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93%E4%B8%8E%E5%BF%83%E5%BE%97/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>微信小程序开发总结与心得 | Bruce Chen's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband">
    <a target="_blank" rel="noopener" href="https://github.com/jschentt" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    </div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Bruce Chen's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">quick notes</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">3</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">7</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">83</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/12/16/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93%E4%B8%8E%E5%BF%83%E5%BE%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/portal.jpg">
      <meta itemprop="name" content="Bruce Chen">
      <meta itemprop="description" content="It's better to burn out than to fade away.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Bruce Chen's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          微信小程序开发总结与心得
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-12-16 13:58:49 / 修改时间：14:01:51" itemprop="dateCreated datePublished" datetime="2022-12-16T13:58:49+08:00">2022-12-16</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">小程序开发</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="1-微信小程序基本知识与概念"><a href="#1-微信小程序基本知识与概念" class="headerlink" title="1 微信小程序基本知识与概念"></a>1 微信小程序基本知识与概念</h2><p>微信小程序开发，入门算是非常简单，只要看官方文档即可<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/">小程序简易教程</a>。如何申请小程序账号，如何开发自己第一个小程序，如何发布，这一系列 hello world 操作官方文档都有手把手教学。小程序开发的每个步骤，提供的能力文档里都有，个人觉得，做小程序开发，有事没事都看下文档，因为小程序更新比较快速，同时一些细小的能力我们可能会漏掉，所以多看文档。</p>
<h3 id="1-1-简单说下目录结构和-app-json"><a href="#1-1-简单说下目录结构和-app-json" class="headerlink" title="1.1 简单说下目录结构和 app.json"></a>1.1 简单说下目录结构和 app.json</h3><p><strong>文件目录结构很灵活</strong></p>
<p>先来看看小程序项目的文件目录结构</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9224001-101ad1c2c34b78e2?imageMogr2/auto-orient/strip%7CimageView2/2/w/358/format/webp" alt="image"></p>
<p>除了 app.json 必须位于根目录下，其他文件随意，并且都可以删。并且页面文件可以放到任何位置，只要在 app.json 中的 pages 中配置了就可以。可以说是很灵活。你还可以多个页面放在同个文件夹下。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9224001-34ea9f7b6d403430?imageMogr2/auto-orient/strip%7CimageView2/2/w/294/format/webp" alt="image"></p>
<p><strong>接下来简单介绍下各个文件</strong>:</p>
<p>全局配置文件 app.json<br>对于一个小程序项目而言，最重要的文件是 app.json，它也是开发工具识别一个文件夹是否为小程序项目的标识。当使用开发者工具创建一个项目时，如果选择的是空文件夹，它会创建一个新的项目。如果是一个有文件的文件夹，它会看该文件夹中是否有 app.json 文件，如果有，则它会认为是一个小程序项目，则会打开该项目，如果文件夹中没有 app.json 文件，则提示无法创建项目。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9224001-f636fee7c8bb0521?imageMogr2/auto-orient/strip%7CimageView2/2/w/411/format/webp" alt="image"></p>
<p>app.json 必须放置于项目的根目录下，它是小程序项目的全局配置文件。在小程序代码包准备完成进行启动后（下文会详细介绍小程序从用户点击打开小程序到小程序销毁的整个过程），会先读取 app.json 文件，进行小程序的初始化，比如初始化整个小程序外框样式，获取首页页面地址等。</p>
<blockquote>
<p>其实小程序就是微信提供的一个容器，各个页面就在这个容器里加载运行销毁</p>
</blockquote>
<p>下面介绍下小程序的全局配置选项:</p>
<p>注意：</p>
<blockquote>
<ul>
<li>所有配置项 key 必须使用双引号括起来，value 值为字符串类型的也必须使用双引号，不支持单引号</li>
<li>因为小程序功能迭代非常迅速，基础库版本更新也很快，所以下面的介绍是截止目前的最新版本库 2.4.0</li>
</ul>
</blockquote>
<ul>
<li><strong>pages</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;pages&quot;: [</span><br><span class="line">        &quot;pages/index/index&quot;,</span><br><span class="line">        &quot;pages/log/log&quot;</span><br><span class="line">    ]</span><br></pre></td></tr></table></figure>

<p>在 app.json 中，pages 选项是必须配置的。该配置项注册了小程序所有页面的地址，其中每一项都是页面的 <strong>路径+文件名</strong> 。配置的字符串其实就是每个页面 wxml 路径，去掉.wxml 后缀。因为框架会自动去寻找路径下.json、.js、.wxml、.wxss 四个文件进行整合。也就意味着.json、.js、.wxss 这三个文件的文件名必须要和.wxml 的一致，否则不生效。所以一个页面至少必须得有.wxml 文件。</p>
<blockquote>
<p>总结：</p>
<p>页面的.json、.js、.wxss 文件必须与.wxml 文件同名，否则不生效<br>每个页面都必须在 pages 下注册，没有注册的页面，如果不访问，编译能通过，一旦试图访问该页面则会报错<br>可以通过在 pages 下添加一个选项快速新建一个页面，开发工具会自动生成对应的文件</p>
</blockquote>
<ul>
<li><strong>window</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;window&quot;:&#123;</span><br><span class="line">    &quot;enablePullDownRefresh&quot;: ture,</span><br><span class="line">    &quot;navigationStyle&quot;: &quot;custom&quot;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>该配置项用于配置小程序的全局外观样式，具体请查阅文档。这里重点提一下两个比较实用的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//去掉默认的导航栏，轻松实现全面屏</span><br><span class="line">&quot;navigationStyle&quot;: &quot;custom&quot; ,</span><br><span class="line">//开启自带的下拉刷新，减少自己写样式</span><br><span class="line">&quot;enablePullDownRefresh&quot;: true,</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>tabBar</strong><br>该选项可以让我们轻松实现导航栏 tab 效果，不过有个不足就是跳转可操作性非常低。就是每个 tab 只能跳当前小程序页面，不能跳到其他小程序。如果需要跳到其他小程序，还需自己封装个组件。</p>
</li>
<li><p><strong>networkTimeout</strong><br>这是网络请求超时时间，可以设置不同类型请求的超时时间，比如 wx.request、wx.uploadFile 等。其实很多时候我们都会忽略这个选项，小程序默认是 60s 超时，但我们应该手动设置更低的值，因为我们的接口一般都会在 10s 内完成请求（如果超过 10s，那你是时候优化了），所以如果网络或者服务器出问题了，那么会让用户等 60s，最后还是失败，这对用户很不友好，还不如提前告诉用户，现在出问题了，请稍后再试。</p>
</li>
</ul>
<p>前段时间由于公司服务器网关出现了点小问题，导致有些请求连接不上，出现大量连接超时。通过之前添加的错误信息收集插件(这个是性能优化，下文有讲到)看到了很多接口返回 time-out 60s。让用户等了 60s 还是失败，这不友好。所以这个超时时间一般设置 15s-30s 比较好。</p>
<ul>
<li><p><strong>debug</strong><br>是否开启 debug 功能，开启后查看更多的调试信息，方便定位问题，开发阶段可以考虑开启</p>
</li>
<li><p><strong>functionalPages</strong><br>这个是结合插件使用的，因为微信小程序插件有很大限制，插件里提供的 api 很有限，wx.login 和 wx.requestPayment 在插件中不能使用，如果需要获取用户信息和进行支付，就必须通过插件提供的功能去实现。当你的小程序下的插件启用了插件功能时，必须设置该选项为 true</p>
</li>
</ul>
<blockquote>
<p>小程序插件必须挂载在一个微信小程序中，一个小程序也只能开通一个插件。当你小程序开通的插件启用了插件功能时，必须设置该选项为 true</p>
</blockquote>
<ul>
<li><strong>plugins</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&quot;plugins&quot;: &#123;</span><br><span class="line">    &quot;myPlugin&quot;: &#123;</span><br><span class="line">        &quot;version&quot;: &quot;1.0.0&quot;,</span><br><span class="line">        &quot;provider&quot;: &quot;wxidxxxxxxxxxxxxxxxx&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当小程序使用了插件就必须在这里声明引入。小程序自身开通的小程序不能在本身应用</p>
<ul>
<li><strong>navigateToMiniProgramAppIdList</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;navigateToMiniProgramAppIdList&quot;: [</span><br><span class="line">    &quot;wxe5f52902cf4de896&quot;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>之前小程序之间只要是关联了通过公众号就可以相互跳转，如今微信做出了限制，要这里配置好需要跳转的小程序，上限为 10 个，还必须写死，不支持配置。所以当小程序有跳转到其他小程序，一定要配好这个，否则无法跳转。</p>
<ul>
<li><strong>usingComponents</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;usingComponents&quot;: &#123;</span><br><span class="line">    &quot;hello-component&quot;: &quot;plugin://myPlugin/hello-component&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用自定义组件或者插件提供的组件前，必须先在这里声明</p>
<h3 id="1-2-小程序启动与生命周期"><a href="#1-2-小程序启动与生命周期" class="headerlink" title="1.2 小程序启动与生命周期"></a>1.2 小程序启动与生命周期</h3><p>下面来说说小程序从用户点击打开到销毁的整个过程。用图说话更清晰，特地画了个流程图：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9224001-453ef44118136478?imageMogr2/auto-orient/strip%7CimageView2/2/w/985/format/webp" alt="image"></p>
<blockquote>
<p>小程序启动会有两种情况，一种是「冷启动」，一种是「热启动」。 假如用户已经打开过某小程序，然后在一定时间内再次打开该小程序，此时无需重新启动，只需将后台态的小程序切换到前台，这个过程就是热启动；冷启动指的是用户首次打开或小程序被微信主动销毁后再次打开的情况，此时小程序需要重新加载启动。</p>
</blockquote>
<p>上面的流程图包含了所有内容，但毕竟文字有限，接下来详细说下几个点。</p>
<ol>
<li>小程序会先检测本地是否有代码包，然后先使用本地代码包进行小程序启动，再异步去检测远端版本。这就是小程序的离线能力，相对于 H5，这是优点，能加快小程序启动速度。</li>
<li>当本地有小程序代码包时，会异步去请求远端是否有最新版本。有则下载到本地，但该次的启动还是会用之前的代码。所以当我们发布了最新的版本，需要用户两次冷启动，才能使用到最新版本。如果想要用户一次冷启动就可以使用到最新版本，可以使用小程序提供的版本更新<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/api/update/wx.getUpdateManager.html">API 更新</a>。代码如下，只要在 app.js 的 onShow 函数加上以下代码，每次小程序有更新，都会提示用户更新小程序。不过这个每次提示更新，一定程度上影响用户体验。如果结合后端配置，每次进来读取配置，就可以实现根据需要是否进行该版本的更新，比如一定需要用户更新才能使用的，那就使用强制更新。对于一些小版本，就不需要使用这个强制更新。</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">if (wx.canIUse(&#x27;getUpdateManager&#x27;)) &#123;</span><br><span class="line">        //检测是否有版本更新</span><br><span class="line">        var updateManager = wx.getUpdateManager()</span><br><span class="line">        updateManager.onCheckForUpdate(function (res) &#123;</span><br><span class="line">            // 请求完新版本信息的回调，有更新</span><br><span class="line">            if (res.hasUpdate) &#123;</span><br><span class="line">                wx.showLoading(&#123;</span><br><span class="line">                    title: &#x27;检测到新版本&#x27;,</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        updateManager.onUpdateReady(function () &#123;</span><br><span class="line">            wx.hideLoading();</span><br><span class="line">            wx.showModal(&#123;</span><br><span class="line">                title: &#x27;更新提示&#x27;,</span><br><span class="line">                content: &#x27;新版本已经准备好，是否重启应用？&#x27;,</span><br><span class="line">                success: function (res) &#123;</span><br><span class="line">                    if (res.confirm) &#123;</span><br><span class="line">                        //清楚本地缓存</span><br><span class="line">                        try &#123;</span><br><span class="line">                            wx.clearStorageSync()</span><br><span class="line">                        &#125; catch (e) &#123;</span><br><span class="line">                            // Do something when catch error</span><br><span class="line">                        &#125;</span><br><span class="line">                        // 新的版本已经下载好，调用 applyUpdate 应用新版本并重启</span><br><span class="line">                        updateManager.applyUpdate()</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">        updateManager.onUpdateFailed(function () &#123;</span><br><span class="line">            // 新的版本下载失败</span><br><span class="line">            console.log(&#x27;新版本下载失败&#x27;);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-3-开发工具"><a href="#1-3-开发工具" class="headerlink" title="1.3 开发工具"></a>1.3 开发工具</h3><p>对于小程序开发工具，还没有一款让开发者满意的工具，至少我不满意，哈哈哈！微信提供的<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/devtools/devtools.html">微信开发者工具</a>。除了编译器不行外，其他都还行。但由于开发工具、ios、android 三个平台运行小程序的内核不同。所以有时会出现开发工具上没问题，真机有问题的情况，特别是样式，可以通过在开发工具中设置<strong>上传代码时样式自动补全</strong>来解决大多数问题。另外微信开发者工具提供了真机调试功能，该功能对真机调试非常方便</p>
<p>还有就是可以自定义编译条件</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9224001-9d9e1ef862ec01a2?imageMogr2/auto-orient/strip%7CimageView2/2/w/668/format/webp" alt="image"></p>
<p>可以模拟任意场景值、设置页面参数、模拟更新等。基本满足了所有的调试。不过还有一些效果，开发工具和真机可能会不同，所以还是需要在真机上确认。</p>
<h3 id="1-4-测试-审核-上线的那些事"><a href="#1-4-测试-审核-上线的那些事" class="headerlink" title="1.4 测试-审核-上线的那些事"></a>1.4 测试-审核-上线的那些事</h3><p>服务器域名 request 合法域名每个月只能修改 5 次。所以不应该每次请求一个新域名就添加一次。在开发阶段，在微信开发者工具上勾上不校验合法域名，真机上需要开启调试模式，就可以先不配置合法域名的情况下请求任何域名甚至 ip 地址。待开发完成了，再一次性配置所有合法域名，在微信开发者工具上取消不校验合法域名，真机上关闭调试模式，然后开始测试。</p>
<p>使用体验版+线上环境的接口，这就是和线上环境一模一样的，所以在发布前，使用体验版+线上环境过一遍。如果没问题，发布以后也就没问题了。</p>
<p>小程序二维码只要发布了线上版本调用生成小程序二维码接口才能成功返回二维码。而且二维码识别是线上版本，所以还未发布的小程序是无法生成二维码的。</p>
<p>线上版本有个版本回退功能，这里有个坑，就是版本回退以后，退回的版本需要重新审核才能发布</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9224001-7f06298163544864?imageMogr2/auto-orient/strip%7CimageView2/2/w/307/format/webp" alt="image"></p>
<p>还有设置体验版时可以设置指定路径和参数，这样很方便测试</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9224001-5430f5ac8e795afe?imageMogr2/auto-orient/strip%7CimageView2/2/w/610/format/webp" alt="image"></p>
<h2 id="2-重点介绍几个组件"><a href="#2-重点介绍几个组件" class="headerlink" title="2 重点介绍几个组件"></a>2 重点介绍几个组件</h2><p>接下来说说使用频率比较多，功能强大，但又有比较多坑的几个组件</p>
<h3 id="2-1-web-view"><a href="#2-1-web-view" class="headerlink" title="2.1 web-view"></a>2.1 web-view</h3><p>web-view 的出现，让小程序和 H5 网页之前的跳转成为了可能。通过把 H5 页面放置到 web-view 中，可以让 H5 页面在小程序内运行。同时在 H5 页面中也可以跳转回小程序页面。可以说是带来了很大的便利，但同时由于 web-view 的诸多限制，用起来也不是很舒服。</p>
<blockquote>
<ol>
<li>需要打开的 H5 页面必须在后台业务页面中配置，这其中还有个服务校验。另外 H5 页面必须是 https 协议，否则无法打开</li>
<li>web-view 中无法在页面中调起分享，如果需要分享，比如跳回小程序原生页面</li>
<li>小程序与 web-view 里 H5 通信问题。小程序向 web-view 传递，不敏感信息可以通过页面 url 传递。如果是敏感信息比如用户 token 等，可以让服务端重定向，比如请求服务端一个地址，让他把敏感信息写在 cookie 中，再重定向到我们的 H5 页面。之后 H5 页面就可以通过在 cookie 中拿这些敏感数据了，或者 http-only，发送请求时直接带上。</li>
<li>每次 web-view 中 src 值有变化就会重新加载一次页面。所以用 src 拼接参数时，需要先赋值给一个变量拼接好，再一次性 setData 给 web-view 的 src，防止页面重复刷新</li>
<li>从微信客户端 6.7.2 版本开始，navigationStyle: custom 对<web-view>组件无效。也就意味着使用 web-view 时，自带的导航栏无法去掉。</li>
<li>因为导航栏无法去掉，这里就出现了一个巨大的坑。实现全屏效果问题。如果想要实现 H5 页面全屏，就是不滑动，全屏显示完所有内容。这时如果你使用 width:100%;height:100%，你会发现，你页面底部可能会缺失一段。上图:</li>
</ol>
</blockquote>
<p><img src="https://upload-images.jianshu.io/upload_images/9224001-9488d1d3f38ec3b2?imageMogr2/auto-orient/strip%7CimageView2/2/w/864/format/webp" alt="image"></p>
<p>因为 web-view 是默认铺满全屏的，也就是 web-view 宽高和屏幕宽高一样。然后 H5 页面这是高度 100%，这是相对 web-view 的高度，也是屏幕高度。但是关键问题：<strong>web-view 里 H5 页面是从导航栏下开始渲染的</strong>。这就导致了 H5 页面溢出了屏幕，无法达到全屏效果。</p>
<p><strong>解决方法</strong></p>
<p>这个问题我在前段时间的实际项目碰到过，我们要做个 H5 游戏，要求是全屏，刚开始我也是设置高度 100%。后来发现底部一块不见了。我的解决方法比较粗暴，如果有更好的解决方法，欢迎评论交流。<br>我的解决方法是：通过拼接宽高参数在 H5 页面 url 上，这个宽高是在 web-view 外层计算好的。H5 页面直接读取 url 上的宽高，动态设置页面的宽高。页面高度的计算，根据上图，很显然就是屏幕高度减去导航栏高度。宽度都是一样的，直接是屏幕宽度。</p>
<p>但问题又来了，貌似没有途径获取导航栏高度。而且对于不同机型的手机，导航栏高度不同。经过了对多个机型导航栏跟屏幕高度的比较。发现了一个规律，导航栏高度与屏幕高度、屏幕宽高比有一定的关系。所以根据多个机型就计算出了这个比例。这解决了 95%以上手机的适配问题，只有少数机型适配不是很好。基本实现了全屏效果。具体代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">onLoad (options) &#123;</span><br><span class="line">    //同步获取屏幕信息，现在用到的是屏幕宽高</span><br><span class="line">    var res = wx.getSystemInfoSync();</span><br><span class="line">    if (res) &#123;</span><br><span class="line">        var widHeight = res.screenHeight;</span><br><span class="line">        //对于大多数手机，屏幕高度/屏幕宽度 = 1.78。此时导航栏占屏幕高度比为0.875</span><br><span class="line">        var raito = 0.875;</span><br><span class="line">        if (res.screenHeight / res.screenWidth &gt; 1.95) &#123;</span><br><span class="line">            //对于全屏手机，这个占比会更高些</span><br><span class="line">            raito = 0.885;</span><br><span class="line">        &#125; else if (res.screenHeight / res.screenWidth &gt; 1.885) &#123;</span><br><span class="line">            raito = 0.88;</span><br><span class="line">        &#125;</span><br><span class="line">        //做兼容处理，只有微信版本库高于6.7.2，有导航栏才去兼容，否则可以直接使用高度100%。res.statusBarHeight是手机顶部状态栏高度</span><br><span class="line">        //如果微信版本号大于6.7.2，有导航栏</span><br><span class="line">        if (util.compareVersion(res.version, &quot;6.7.2&quot;) &gt; 0) &#123;</span><br><span class="line">            widHeight = Math.round(widHeight * raito) + (res.statusBarHeight || 0);</span><br><span class="line">        &#125;</span><br><span class="line">        this.setDate(&#123;</span><br><span class="line">            //将H5页面宽高拼接在url上，赋值给web-view的src即可加载出H5页面</span><br><span class="line">            webview_src: util.joinParams(h5_src, &#123;</span><br><span class="line">                &quot;height&quot;: widHeight,</span><br><span class="line">                &quot;width&quot;: res.screenWidth</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-scroll-view"><a href="#2-2-scroll-view" class="headerlink" title="2.2 scroll-view"></a>2.2 scroll-view</h3><p>当我们要实现一个区域内滑动效果时，在 H5 页面中我们设置<code>overflow-y: scroll</code>即可。但在小程序中，没有该属性。需要用到 scroll-view 标签。具体操作实现我们可以查看文件<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/component/scroll-view.html">scroll-view</a>。</p>
<p>锚点定位在前端开发中会经常用到，在 H5 页面中，我们会在 url 后面加上#来实现锚点定位效果。但是在小程序中这样是不起作用的，因为小程序内渲染页面的容器不是一个浏览器，无法实时监听 Hash 值的变化。但是使用 scroll-view，我们可以实现锚点定位效果。主要是使用 scroll-into-view 属性，具体实现我们直接上代码</p>
<blockquote>
<p>scroll-into-view | String | 值应为某子元素 id（id 不能以数字开头）。设置哪个方向可滚动，则在哪个方向滚动到该元素</p>
</blockquote>
<blockquote>
<p>wxml 文件</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--toView的值动态变化，当toView为luckydraw时，会定位到id为luckydraw的view</span><br><span class="line">    需要注意的是，这里需要设置高度为屏幕高度--&gt;</span><br><span class="line">    &lt;scroll-view scroll-y scroll-into-view=&quot;&#123;&#123;toView&#125;&#125;&quot;</span><br><span class="line">    scroll-with-animation = &quot;true&quot; style=&quot;height: 100%; white-space:nowrap&quot;&gt;</span><br><span class="line">        &lt;view id=&quot;top&quot;&gt;&lt;/view&gt;</span><br><span class="line">        &lt;view id=&quot;luckydraw&quot;&gt;&lt;/view&gt;</span><br><span class="line">        &lt;view id=&quot;secskill&quot;&gt;&lt;/view&gt;</span><br><span class="line">    &lt;scroll-view&gt;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-canvas"><a href="#2-3-canvas" class="headerlink" title="2.3 canvas"></a>2.3 canvas</h3><p>画布标签，它是原生组件，所以它必须位于屏幕最上边，而且是不能隐藏的。所以如果想要使用 canvas 动态生成分享照片。那你要设置她的宽高和屏幕一样。要不导出为照片时就会失真。因为这个原因，所以生成分享照片还是由服务端实现吧，照片失真太严重了。</p>
<h2 id="3-formid-收集"><a href="#3-formid-收集" class="headerlink" title="3 formid 收集"></a>3 formid 收集</h2><p>给用户发送消息对一个小程序是非常重要的，它可以召唤回用户，导量效果非常明显。我们可以通过模板消息向小程序用户发送消息，但前提是我们得获取到 openid 和 formid。用户登录我们即可获取到用户 openid。而只要用户有点击行为，我们即可<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/component/form.html">获取 formid</a>。所以说 formid 是很重要的。我们可以提前收集好 formid，在需要的时候给用户推送消息。我们可以给每个 button 都包上 form 标签，只要有用户点击行为都可以收集到 formid.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;form bindsubmit=&quot;formSubmit&quot; report-submit=&#x27;true&#x27;&gt;</span><br><span class="line">    &lt;button  formType=&quot;submit&quot;&gt;点击&lt;/button&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>

<p>我们实现一个 formid 收集系统，为了尽量减少冗余代码和减少对业务的影响，我们的设计是这样的</p>
<ol>
<li>在整个页面的最外层包裹 form 标签，不是每个 button 都包裹一个，这样只要是页面中<code>formType=submit</code>的 button 有点击都能获取到 formid。</li>
<li>formid 保存在全局变量数组中，当小程序切换到后台是一次性发送。</li>
<li>对于需要实时发送消息的，不添加到全局数组中，直接保存在页面变量中。</li>
</ol>
<blockquote>
<p>wxml 文件</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--在整个页面的最外层包裹form标签，这样就不必对每个button都包裹一个form标签，代码简洁--&gt;</span><br><span class="line">&lt;form bindsubmit=&quot;formSubmit&quot; report-submit=&#x27;true&#x27;&gt;</span><br><span class="line">    &lt;view&gt;页面内容&lt;/view&gt;</span><br><span class="line">    &lt;view&gt;页面内容&lt;/view&gt;</span><br><span class="line">    &lt;button  formType=&quot;submit&quot;&gt;点击&lt;/button&gt;</span><br><span class="line">    &lt;view&gt;页面内容&lt;/view&gt;</span><br><span class="line">    &lt;view&gt;</span><br><span class="line">        &lt;button  formType=&quot;submit&quot;&gt;点击&lt;/button&gt;</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>page.js 文件</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//每次用户有点击，都将formid添加到全局数组中</span><br><span class="line">formSubmit(e) &#123;</span><br><span class="line">    //需要实时发送的，不添加</span><br><span class="line">    if(e.target.dataset.sendMsg)&#123;</span><br><span class="line">        formid =  e.detail.formId;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    app.appData.formIdArr.push(e.detail.formId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>app.js</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">onHide: function () &#123;</span><br><span class="line">    //小程序切到后台时上传formid</span><br><span class="line">    this.submitFormId();</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h2 id="4-性能优化相关"><a href="#4-性能优化相关" class="headerlink" title="4 性能优化相关"></a>4 性能优化相关</h2><p>从用户打开小程序到小程序销毁，我们可以想想有哪些地方是可以优化的。首先是打开速度。小程序打开速度直接影响了用户留存。在小程序后台，运维中心-监控告警下有个加载性能监控数据，我们可以看到小程序启动总耗时、下载耗时、首次渲染耗时等加载相关的数据。而这里的打开速度其实就是小程序的启动总耗时。它包括了代码包下载、首次渲染，微信内环境初始化等步凑。在这一步，我们能做的就是<strong>如何加快代码包下载速度和减少首次渲染时间</strong></p>
<p>在小程序呈现给用户之后，接下来就是如何提高用户体验，增强小程序健壮性的问题了。每个程序都有 bug。只是我们没发现而已，尽管在测试阶段，我们进行了详尽的测试。但是在实际生产环境，不同的用户环境，不同的操作路径，随时会触发一些隐藏的 bug。这时如果用户没有向我们报告，我们是无法获知的。所以有必要给我们的小程序<strong>增加错误信息收集</strong>，js 脚本错误，意味着整个程序挂掉了，无法响应用户操作。所以对于运行时的脚本错误，我们应该上报。对出现的 bug 及时修复，增强程序健壮性，提高用户体验。</p>
<p>每个程序都有大量的前后端数据交互，这是通过 http 请求进行的。因此，还有一个错误信息收集就是接口错误信息收集。对那些请求状态码非 2XX、3XX 的，或者请求接口成功了，但是数据不是我们预期的，都可以进行信息采集。</p>
<p>通过对小程序运行时脚本和 http 请求进行监控，我们就可以实时了解我们线上小程序的运行状况，有什么问题可以及时发现，及时修复，极高地提高了用户体验性。</p>
<h3 id="4-1-让小程序更快"><a href="#4-1-让小程序更快" class="headerlink" title="4.1 让小程序更快"></a>4.1 让小程序更快</h3><p>让小程序快，主要因素有两个，代码包下载和首屏渲染。<br>我们来看一个数据：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9224001-59f56fb9a79610ae?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp" alt="image"></p>
<p>前面状态小程序代码大小是 650Kb 左右，这是下载耗时（虽然跟用户网络有关，但这个是全部用户平均时间）是 1.3s 左右。但是经过优化，将代码包降低至 200kb 左右时。下载耗时只有 0.6s 左右。所以说，代码包减少 500kb，下载耗时能减少 0.5s。这个数据还是非常明显的。所以说，在不影响业务逻辑的情况下，我们小程序代码包应该尽可能地小。那么如何降低代码包大小呢？以下有几点可以参考</p>
<ol>
<li><p>因为我们上传代码到微信服务器时，它会将我们的代码进行压缩的，所以用户下载的代码包并不是我们开发时的那个大小。对此，开发时也没必要删空行、删注释这些。在开发工具项目详情中可以看到上次上传大小，这个大小就是用户最终使用的大小。如果觉得微信压缩还不够好，可以通过第三方工具对我们代码进行一次压缩再上传，然后对比效果，有没有更小。这个没有使用过。如果有什么好工具，欢迎推荐。</p>
</li>
<li><p>将静态资源文件上传到我们自己服务器或者 cdn 上。一个小程序，最耗空间的往往是图片文件。所以我们可以抽离出来，图片文件可以异步获取，在小程序启动以后再去获取。这样，代码包就会小很多。</p>
</li>
<li><p>使用分包加载。小程序提供了分包加载功能。如果你的小程序很庞大，可以考虑使用分包加载功能，先加载必要功能代码。这样就可以极大降低代码包大小<br>接下来是首屏渲染，从上图的小程序生命周期可以看出，从加载首页代码到首页完成渲染，这段时间就是白屏时间，也就是首次渲染时间。而小程序在这段时间内，主要工作是：加载首页代码、创建 View 和 AppService 层、初始数据传输、页面渲染。在这四个步骤中，加载首页代码，前面已经说过；创建 View 和 AppService 层，是微信完成的，跟用户手机有关，这不是我们可控的。我们能做的就是减少初始数据传输时间和页面渲染时间。</p>
</li>
<li><p>我们知道 page.js 中的 data 对象在首次渲染时会通过数据管道传到视图层进行页面渲染。所以我们应该控制这个 data 对象的大小。对于与视图渲染无关的数据，不要放在 data 里面，可以设置个全局变量来保存。</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">        //与页面渲染有关的数据放这里</span><br><span class="line">        data: &#123;</span><br><span class="line">            goods_list:[]</span><br><span class="line">        &#125;,</span><br><span class="line">        //与页面渲染无关的数据放这里</span><br><span class="line">        _data: &#123;</span><br><span class="line">            timer: null</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>页面渲染速度还跟 html 的 dom 结构有关。这一点的优化空间算是非常少了，就是写高质量 html 代码，减少 dom 嵌套，让页面渲染速度快一丢丢。</li>
</ol>
<h3 id="4-2-让小程序更强"><a href="#4-2-让小程序更强" class="headerlink" title="4.2 让小程序更强"></a>4.2 让小程序更强</h3><p>接下来就是给小程序增加错误信息收集，包括 js 脚本错误信息收集和 http 请求错误信息收集。前段时间，在实际工作开发中，为了更好的复用和管理，我把这个错误信息收集功能做成了插件。然而做成插件并没有想象中的那么美好，下面再具体说。</p>
<p><strong>脚本错误收集</strong></p>
<p>对于脚本错误收集，这个相对比较简单，因为在 app.js 中提供了监听错误的 onError 函数</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9224001-0bbdba7dbe77acc9?imageMogr2/auto-orient/strip%7CimageView2/2/w/1118/format/webp" alt="image"></p>
<p>只不过错误信息是包括堆栈等比较详细的错误信息，然后当上传时我们并不需要这么多信息，第一浪费宽带，第二看着累又无用。我们需要的信息是：错误类型、错误信息描述、错误位置。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">thirdScriptError</span><br><span class="line">aa is not defined;at pages/index/index page test function</span><br><span class="line">ReferenceError: aa is not defined</span><br><span class="line">    at e.test (http://127.0.0.1:62641/appservice/pages/index/index.js:17:3)</span><br><span class="line">    at e.&lt;anonymous&gt; (http://127.0.0.1:62641/appservice/__dev__/WAService.js:16:31500)</span><br><span class="line">    at e.a (http://127.0.0.1:62641/appservice/__dev__/WAService.js:16:26386)</span><br><span class="line">    at J (http://127.0.0.1:62641/appservice/__dev__/WAService.js:16:20800)</span><br><span class="line">    at Function.&lt;anonymous&gt; (http://127.0.0.1:62641/appservice/__dev__/WAService.js:16:22389)</span><br><span class="line">    at http://127.0.0.1:62641/appservice/__dev__/WAService.js:16:27889</span><br><span class="line">    at http://127.0.0.1:62641/appservice/__dev__/WAService.js:6:16777</span><br><span class="line">    at e.(anonymous function) (http://127.0.0.1:62641/appservice/__dev__/WAService.js:4:3403)</span><br><span class="line">    at e (http://127.0.0.1:62641/appservice/appservice?t=1543326089806:1080:20291)</span><br><span class="line">    at r.registerCallback.t (http://127.0.0.1:62641/appservice/appservice?t=1543326089806:1080:20476)</span><br></pre></td></tr></table></figure>

<p>这是错误信息字符串，接下来我们对它进行截取只需要拿我们想要的信息即可。我们发现这个字符串是有规则的。第一行是错误类型，第二行是错误详情和发生的位置，并且是”;”分号分开。所以我们还是很容易就可以拿到我们想要的信息。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">//格式化错误信息</span><br><span class="line">function formateErroMsg(errorMsg)&#123;</span><br><span class="line">    //包一层try catch 不要让信息收集影响了业务</span><br><span class="line">    try&#123;</span><br><span class="line">        var detailMsg = &#x27;&#x27;;</span><br><span class="line">        var detailPosition= &#x27;&#x27;;</span><br><span class="line">        var arr = errorMsg.split(&#x27;\n&#x27;)</span><br><span class="line">        if (arr.length &gt; 1) &#123;</span><br><span class="line">            //错误详情和错误位置在第二行并用分好隔开</span><br><span class="line">            var detailArr = arr[1].split(&#x27;;&#x27;)</span><br><span class="line">            detailMsg = detailArr.length &gt; 0 ? detailArr[0] : &#x27;&#x27;;</span><br><span class="line">            if (detailArr.length &gt; 1) &#123;</span><br><span class="line">                detailArr.shift()</span><br><span class="line">                detailPosition = detailArr.join(&#x27;;&#x27;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        var obj = &#123;</span><br><span class="line">            //错误类型就是第一行</span><br><span class="line">            error_type: arr.length &gt; 0 ? arr[0] : &#x27;&#x27;,</span><br><span class="line">            error_msg: detailMsg,</span><br><span class="line">            error_position: detailPosition</span><br><span class="line">        &#125;;</span><br><span class="line">        return obj</span><br><span class="line">    &#125;catch(e)&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>获取到我们想要的信息，就可以发送到我们服务后台，进行数据整理和显示，这个需要服务端配合，就不深入讲了，我们拿到了数据，其他都不是事。</p>
<p><strong>http 请求错误信息收集</strong></p>
<p>对于 http 请求错误信息收集方式，我们尽量不要暴力埋点，每个请求发送前发送后加上我们的埋点。这样工作量太大，也不易维护。因此，我们可以从底层出发，<strong>拦截 wx.request 请求</strong>。使用 Object.defineProperty 对 wx 对象的 request 进行重新定义。具体实现如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">function rewriteRequest()&#123;</span><br><span class="line">    try &#123;</span><br><span class="line">        const originRequest = wx.request;</span><br><span class="line">        Object.defineProperty(wx, &#x27;request&#x27;, &#123;</span><br><span class="line">            configurable:true,</span><br><span class="line">            enumerable: true,</span><br><span class="line">            writable: true,</span><br><span class="line">            value: function()&#123;</span><br><span class="line">                let options = arguments[0] || &#123;&#125;;</span><br><span class="line">                //对于发送错误信息的接口不收集，防止死循环</span><br><span class="line">                var regexp = new RegExp(&quot;https://xxxx/error&quot;,&quot;g&quot;);</span><br><span class="line">                if (regexp.test(options.url)) &#123;</span><br><span class="line">                    //这里要执行原来的方法</span><br><span class="line">                    return originRequest.call(this, options)</span><br><span class="line">                &#125;</span><br><span class="line">                //这里拦截请求成功或失败接口，拿到请求后的数据</span><br><span class="line">                [&quot;success&quot;, &quot;fail&quot;].forEach((methodName) =&gt; &#123;</span><br><span class="line">                    let defineMethod = options[methodName];</span><br><span class="line">                    options[methodName] = function()&#123;</span><br><span class="line">                        try&#123;          //在重新定义函数中执行原先的函数，不影响正常逻辑</span><br><span class="line">                            defineMethod &amp;&amp; defineMethod.apply(this, arguments);</span><br><span class="line">                            //开始信息收集</span><br><span class="line">                            let statusCode, result, msg;</span><br><span class="line">                            //请求失败</span><br><span class="line">                            if (methodName == &#x27;fail&#x27;) &#123;</span><br><span class="line">                                statusCode = 0;</span><br><span class="line">                                result = &#x27;fail&#x27;;</span><br><span class="line">                                msg = ( arguments[0] &amp;&amp; arguments[0].errMsg ) || &quot;&quot;</span><br><span class="line">                            &#125;</span><br><span class="line">                            //请求成功，</span><br><span class="line">                            //收集规则为:</span><br><span class="line">                            // 1、 statusCode非2xx,3xx</span><br><span class="line">                            // 2、 statusCode是2xx,3xx，但接口返回result不为ok</span><br><span class="line">                            if (methodName == &#x27;success&#x27;) &#123;</span><br><span class="line">                                let data = arguments[0] || &#123;&#125;;</span><br><span class="line">                                statusCode = data.statusCode || &quot;&quot;;</span><br><span class="line">                                if (data.statusCode &amp;&amp; Number(data.statusCode) &gt;= 200 &amp;&amp; Number(data.statusCode) &lt; 400 ) &#123;</span><br><span class="line">                                    let resData = data.data ? (typeof data.data == &#x27;object&#x27; ? data.data : JSON.parse(data.data)) : &#123;&#125;;</span><br><span class="line">                                    //请求成功，不收集</span><br><span class="line">                                    if (resData.result == &#x27;ok&#x27;) &#123;</span><br><span class="line">                                        return;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                    result = resData.result || &quot;&quot;;</span><br><span class="line">                                    msg = resData.msg || &quot;&quot;;</span><br><span class="line">                                &#125;else&#123;</span><br><span class="line">                                    result = &quot;&quot;;</span><br><span class="line">                                    msg = data.data || &quot;&quot;;</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                            //过滤掉header中的敏感信息</span><br><span class="line">                            if (options.header) &#123;</span><br><span class="line">                                options.header.userid &amp;&amp; (delete options.header.userid)</span><br><span class="line">                            &#125;</span><br><span class="line">                            //过滤掉data中的敏感信息</span><br><span class="line">                            if (options.data) &#123;</span><br><span class="line">                                options.data.userid &amp;&amp; (delete options.data.userid)</span><br><span class="line">                            &#125;</span><br><span class="line"></span><br><span class="line">                            var collectInfo = &#123;</span><br><span class="line">                                &quot;url&quot;: options.url || &#x27;&#x27;,   //请求地址</span><br><span class="line">                                &quot;method&quot;: options.method || &quot;GET&quot;,  //请求方法</span><br><span class="line">                                &quot;request_header&quot;: JSON.stringify(options.header || &#123;&#125;), //请求头部信息</span><br><span class="line">                                &quot;request_data&quot;: JSON.stringify(options.data || &#123;&#125;), //请求参数</span><br><span class="line">                                &quot;resp_code&quot;: statusCode + &#x27;&#x27;,   //请求状态码</span><br><span class="line">                                &quot;resp_result&quot;: result, //请求返回结果</span><br><span class="line">                                &quot;resp_msg&quot;: msg, //请求返回描述信息</span><br><span class="line">                            &#125;</span><br><span class="line">                            //提交参数与上一次不同，或者参数相同，隔了1s</span><br><span class="line">                            if (JSON.stringify(collectInfo) != lastParams.paramStr || (new Date().getTime() - lastParams.timestamp &gt; 1000)) &#123;</span><br><span class="line">                                //上传错误信息</span><br><span class="line">                                Post.post_error(_miniapp, &#x27;http&#x27;, collectInfo)</span><br><span class="line">                                lastParams.paramStr = JSON.stringify(collectInfo);</span><br><span class="line">                                lastParams.timestamp = new Date().getTime()</span><br><span class="line">                            &#125;</span><br><span class="line"></span><br><span class="line">                        &#125;catch(e)&#123;</span><br><span class="line">                            //console.log(e);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;)</span><br><span class="line">                return originRequest.call(this, options)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125; catch (e) &#123;</span><br><span class="line">        // Do something when catch error</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在不使用插件的小程序中，我们可以在使用 wx.request 方法执行上面的代码，对 wx.request 进行拦截，然后其他无需加任何代码就可以收集 http 请求了。<br>上面说了，当我们封装成到插件时，这个就不管用了，因为当使用插件时，小程序不允许我们修改全局变量。所以执行上面代码时会报错。这时，我们退而求其次，只能是在插件中自己封装个方法，这个方法其实就是 wx.request 发送请求，但是在插件中我们就可以拦截 wx.request 了。具体实现如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function my_request()&#123;</span><br><span class="line">    //只要执行一次拦截代码即可</span><br><span class="line">    !_isInit &amp;&amp; rewriteRequest();</span><br><span class="line">    return  wx.request(options)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接下来我们看下后台数据</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9224001-a5ed578b7aca2063?imageMogr2/auto-orient/strip%7CimageView2/2/w/855/format/webp" alt="image"></p>
<p><img src="https://upload-images.jianshu.io/upload_images/9224001-d8b9492d94d3f88d?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp" alt="image"></p>
<p>持续监控，会帮我们找出很多隐藏的 bug</p>
<h2 id="4-总结"><a href="#4-总结" class="headerlink" title="4 总结"></a>4 总结</h2><p>洋洋洒洒写了这么多，或许有些地方说的不太清楚，慢慢锻炼吧。然后后面几点只是挑了重要的讲，我相信有过小程序开发经验的朋友应该没问题。然后有时间再补充和优化了。先到此，有缘看到的朋友，欢迎留言交流。</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/" rel="tag"># 小程序</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/12/16/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%8F%92%E4%BB%B6-%E5%BC%80%E5%8F%91%E6%95%99%E7%A8%8B/" rel="prev" title="微信小程序插件 - 开发教程">
      <i class="fa fa-chevron-left"></i> 微信小程序插件 - 开发教程
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/12/16/React-router5-x-%E8%B7%AF%E7%94%B1%E7%9A%84%E4%BD%BF%E7%94%A8%E5%8F%8A%E9%85%8D%E7%BD%AE/" rel="next" title="React-router5.x 路由的使用及配置">
      React-router5.x 路由的使用及配置 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86%E4%B8%8E%E6%A6%82%E5%BF%B5"><span class="nav-number">1.</span> <span class="nav-text">1 微信小程序基本知识与概念</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-%E7%AE%80%E5%8D%95%E8%AF%B4%E4%B8%8B%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84%E5%92%8C-app-json"><span class="nav-number">1.1.</span> <span class="nav-text">1.1 简单说下目录结构和 app.json</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%90%AF%E5%8A%A8%E4%B8%8E%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="nav-number">1.2.</span> <span class="nav-text">1.2 小程序启动与生命周期</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7"><span class="nav-number">1.3.</span> <span class="nav-text">1.3 开发工具</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-%E6%B5%8B%E8%AF%95-%E5%AE%A1%E6%A0%B8-%E4%B8%8A%E7%BA%BF%E7%9A%84%E9%82%A3%E4%BA%9B%E4%BA%8B"><span class="nav-number">1.4.</span> <span class="nav-text">1.4 测试-审核-上线的那些事</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E9%87%8D%E7%82%B9%E4%BB%8B%E7%BB%8D%E5%87%A0%E4%B8%AA%E7%BB%84%E4%BB%B6"><span class="nav-number">2.</span> <span class="nav-text">2 重点介绍几个组件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-web-view"><span class="nav-number">2.1.</span> <span class="nav-text">2.1 web-view</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-scroll-view"><span class="nav-number">2.2.</span> <span class="nav-text">2.2 scroll-view</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-canvas"><span class="nav-number">2.3.</span> <span class="nav-text">2.3 canvas</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-formid-%E6%94%B6%E9%9B%86"><span class="nav-number">3.</span> <span class="nav-text">3 formid 收集</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%9B%B8%E5%85%B3"><span class="nav-number">4.</span> <span class="nav-text">4 性能优化相关</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-%E8%AE%A9%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%9B%B4%E5%BF%AB"><span class="nav-number">4.1.</span> <span class="nav-text">4.1 让小程序更快</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-%E8%AE%A9%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%9B%B4%E5%BC%BA"><span class="nav-number">4.2.</span> <span class="nav-text">4.2 让小程序更强</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E6%80%BB%E7%BB%93"><span class="nav-number">5.</span> <span class="nav-text">4 总结</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Bruce Chen"
      src="/images/portal.jpg">
  <p class="site-author-name" itemprop="name">Bruce Chen</p>
  <div class="site-description" itemprop="description">It's better to burn out than to fade away.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">83</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=1440429303&auto=1&height=66"></iframe>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/jschentt" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;jschentt" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:jschentt@gmail.com" title="E-Mail → mailto:jschentt@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/BruceCh56742806" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;BruceCh56742806" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.facebook.com/jinsheng.chen.5439" title="Facebook → https:&#x2F;&#x2F;www.facebook.com&#x2F;jinsheng.chen.5439" rel="noopener" target="_blank"><i class="fab fa-facebook fa-fw"></i>Facebook</a>
      </span>
  </div>





      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Bruce Chen</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
